!function(){"use strict";!function(){const t=["🍋","🍊","🍉","🍈","🍇","🥝","🍓","🍒","🌟","🍀","💎","🎰"],e=[t,["🧣","⛄","🎄","🎁","🎀","🍾","🍷","🔔","🌟","🦌","🎅"],["🌚","🎃","🦇","😈","🧠","👹","👽","🤡","👻","🧟‍","🧛‍","💀"],["🐞","🐟","🐭","🐸","🐓","🐷","🦀","🐍","🦊‍","🦁","🦕","🦖"],["🎯","🎱","🏐","⛳","⚾","🏈","🏀","⚽","🥉","🥈","🥇","🏆"],["💌","🎁","📸","💘","💋","🔞","💑","💍","💎","💖"],["🎴","🎲","🕶","🥃","💷","💴","💵","💰","🍀","💎","🎰","🧞‍️","🃏"],["🥦","🍋","🍆","🍙","🍯","🍑","🍓","🍭","🍫","🍩","🍕","🍗","🥩","🍣"]],s=e[Math.random()*e.length|0],i=/iPad|iPhone|iPod/.test(navigator.platform||""),o=navigator.userAgent.toLowerCase().includes("firefox"),n=navigator.maxTouchPoints>0||"ontouchstart"in window||window.DocumentTouch&&document instanceof window.DocumentTouch;let a=null;class l{sounds=[];nextSound=0;totalSounds=0;constructor(t,e=16){const{sounds:s}=this;for(let i=0;i<e;++i)s.push(new Audio(t));s[0].oncanplay=()=>{this.totalSounds=e}}play(t=1){const{sounds:e,nextSound:s,totalSounds:i}=this,o=e[s];i&&o.paused&&(o.volume=t,o.play(),this.nextSound=(s+1)%i)}stop(){this.sounds.forEach((t=>{t.pause(),t.currentTime=0})),this.nextSound=0}}const c=o?"ogg":"mp3",h=new l(`./sounds/blip.${c}`,32),r=new l(`./sounds/coin.${c}`),d=new l(`./sounds/stop.${c}`),u=new l(`./sounds/unlucky.${c}`),_=new l(`./sounds/win.${c}`);let p=!0;const m={blip(...t){p&&h.play(...t)},coin(...t){p&&r.play(...t)},stop(...t){p&&d.play(...t)},unlucky(...t){p&&u.play(...t)},win(...t){p&&_.play(...t)},enable(){p=!0},disable(){p=!1,h.stop(),r.stop(),d.stop(),u.stop(),_.stop()}},{navigator:S}=window,C=S.vibrate?S.vibrate.bind(S):()=>{},T=[200,50,50,50,50,25,25,25,25,25,25,25,25],I=[25,25,25,25,25,25,25,25,50,50,50,50,50];let O=!0;const E={start(){O&&C(I)},stop(){O&&C(T)},enable(){O=!0},disable(){O=!1,C(0)}};let A=!1,b=null;function y(){A=!0}function g(){A=!1}function L(){A&&(b(),A=!1)}function N(t){b=t,console.trace("setGlobalClickAndTabHandler"),i?(document.ontouchstart=y,document.ontouchmove=g,document.ontouchcancel=g,document.ontouchend=L):document.onmousedown=t}function k(t="",e="",s=null,i=null){const o=document.createElement("DIV");return o.className=Array.isArray(t)?t.join(" "):t,"string"==typeof e?o.innerText=e:e&&o.appendChild(e),i&&(o.style=i),null!==s&&(o.style.transform=`rotate(${s}deg)`),o}class w{static C_REEL="sm__reel";static C_CELL="sm__cell";static C_CELL_SHADOW="sm__cell--has-shadow";static C_CELL_BLUR="sm__cell--has-blur";static C_FIGURE="sm__figure";static C_IS_STOP="is-stop";static V_INDEX="--index";static STOP_ANIMATION_DURATION_MULTIPLIER=5;root;style;index;alpha;shadowCount;angle=0;stopAt=0;constructor(t,e,s,i){this.index=t,this.alpha=e;const{C_REEL:n,C_CELL:a,C_CELL_SHADOW:l,C_CELL_BLUR:c,C_FIGURE:h,C_IS_STOP:r,V_INDEX:d}=w,u=this.root=k([n,r]);if((this.style=u.style).setProperty(d,t),!s)return;let _,p;o?(_=[a,l],p=.5):(_=[a,l,c],p=1);const m=this.shadowCount=Math.max(2,Math.round((i-.5-2*t)*Math.PI/s.length)),S=1/m;!function(t){for(let e=t.length-1;e>0;--e){const s=Math.floor(Math.random()*(e+1));[t[e],t[s]]=[t[s],t[e]]}}(s),s.forEach(((t,s)=>{const i=k(h,t),o=k(a,i,s*e);u.appendChild(o);for(let t=1;t<m;++t)u.appendChild(k(_,i.cloneNode(!0),e*(s+S*t),`opacity: ${p*(1-S*t)}; `))}))}reset(){const{root:t,style:e,stopAt:s}=this;t.classList.remove("is-stop"),e.transform=`rotate(${this.angle=(360-s)%360}deg)`,e.animation="",this.stopAt=0}stop(t,e){const{alpha:s,root:i}=this,o=(360-this.angle-e)%360,n=Math.ceil(o/s),l=n*s,c=`stop-${this.index}`,h=function(t,e,s,i,o){const n=[e,s-.25*i,s+.125*i,s-.0625*i,s+.03125*i,s-.015625*i,s];let l=e,c=0;const h=n.map((t=>{const e=Math.max(Math.abs(t-l)/Math.abs(o),10);return l=t,c+=e,e}));let r=0;return function(t,e){a||(a=document.createElement("style"),a.type="text/css",document.head.appendChild(a)),a.sheet.insertRule(`@keyframes ${t} {\n        ${e}\n    }`,a.length)}(t,h.map((t=>{const e=r+100*t/c;return r=e,e})).map(((t,e)=>`${Math.round(t)}% { transform: rotate(${n[e].toFixed(2)}deg); }`)).join("\n")),c}(c,(360-o)%360,(360-l)%360,s,t)*w.STOP_ANIMATION_DURATION_MULTIPLIER;return this.stopAt=l,this.style.animation=`${c} ${h}ms ease-out forwards`,i.classList.add(w.C_IS_STOP),(i.children[n*this.shadowCount]||i.children[0]).innerText}}class M{static C_HAS_ZOOM="has-zoom";static C_IS_WIN="is-win";static C_IS_FAIL="is-fail";static S_BASE=".sm__base";static S_REELS_CONTAINER=".sm__reelsContainer";static S_DISPLAY=".sm__display";static V_WRAPPER_SIZE="--wrapperSize";static V_REEL_SIZE="--reelSize";static V_DISPLAY_SIZE="--displaySize";static V_DISPLAY_ZOOM="--displayZoom";static V_SHADOW_WEIGHT="--shadowWeight";static UNITS_CENTER=3;static UNITS_MARGIN=1;static UNITS_TOTAL=M.UNITS_CENTER+M.UNITS_MARGIN;static ZOOM_TRANSITION="transform ease-in-out 500ms 250ms";static ZOOM_TRANSITION_DURATION=1e3;static BLIP_RATE=4;static FIREFOX_SHADOW_WEIGHT=.5;static APP_PADDING=32;wrapper;root=document.querySelector(M.S_BASE);reelsContainer=document.querySelector(M.S_REELS_CONTAINER);display=document.querySelector(M.S_DISPLAY);reels=[];blipFading;reelCount;symbols;alpha;speed;zoomTransitionTimeoutID=null;currentCombination=[];currentReel=null;blipCounter=0;lastUpdate=0;isPaused=!1;keydownTimeoutID=null;keydownLastCalled=0;constructor(e,s,i,o=3,n=t,a=!1,l=-.552){this.init(e,s,i,o,n,l),window.onresize=this.handleResize.bind(this),document.onkeydown=this.handleKeyDown.bind(this),document.onkeyup=this.handleKeyUp.bind(this),this.handleClick=this.handleClick.bind(this),a?this.pause():this.resume()}init(t,e,s,i,n,a){this.wrapper=t,this.handleUseCoin=e,this.handleGetPrice=s,this.reelCount=i,this.symbols=n,this.speed=a,this.blipFading=1/i;const l=this.alpha=360/n.length,c=[...n],h=2*i+M.UNITS_CENTER;this.resize(),o&&this.root.style.setProperty(M.V_SHADOW_WEIGHT,M.FIREFOX_SHADOW_WEIGHT);const{reelsContainer:r,reels:d}=this;for(let t=0;t<i;++t){const e=new w(t,l,c,h);r.appendChild(e.root),d.push(e)}r.appendChild(new w(i).root)}start(){this.handleUseCoin(),this.currentCombination=[],this.currentReel=0,this.zoomOut(),this.display.classList.remove(M.C_IS_WIN,M.C_IS_FAIL),this.reels.forEach((t=>t.reset())),a&&(a.remove(),a=null),m.coin(),E.start(),this.lastUpdate=performance.now(),requestAnimationFrame((()=>this.tick()))}stop(){const t=this.checkPrize();this.currentReel=null,this.zoomIn(),t?(m.win(),this.display.classList.add(M.C_IS_WIN),this.handleGetPrice(t)):(m.unlucky(),this.display.classList.add(M.C_IS_FAIL))}tick(){const{reels:t,speed:e,currentReel:s,lastUpdate:i}=this,o=performance.now(),n=(o-i)*e;if(null!==s&&!this.isPaused){0==(this.blipCounter=(this.blipCounter+1)%M.BLIP_RATE)&&m.blip(1-this.blipFading*s),this.lastUpdate=o;for(let e=t.length-1;e>=s;--e){const s=t[e],i=s.angle=(360+(s.angle+n))%360;s.style.transform=`rotate(${i}deg)`}requestAnimationFrame((()=>this.tick()))}}zoomIn(){this.zoom()}zoomOut(){this.zoom(!0)}zoom(t=!1){clearTimeout(this.zoomTransitionTimeoutID);const{root:e}=this;e.style.transition=M.ZOOM_TRANSITION,e.classList[t?"remove":"add"](M.C_HAS_ZOOM),this.zoomTransitionTimeoutID=setTimeout((()=>{e.style.transition=""}),M.ZOOM_TRANSITION_DURATION)}resize(){const{wrapper:t,root:e,reelCount:s,display:i}=this,{style:o}=e,{offsetWidth:n,offsetHeight:a}=t,l=Math.min(n,a)-M.APP_PADDING,c=l/(2*s+M.UNITS_TOTAL)|0;l<=0||c<=0||e.offsetWidth/i.offsetWidth<=0?requestAnimationFrame((()=>this.resize())):(o.setProperty(M.V_WRAPPER_SIZE,`${l}px`),o.setProperty(M.V_REEL_SIZE,`${c}px`),o.setProperty(M.V_DISPLAY_SIZE,c*s+"px"),o.setProperty(M.V_DISPLAY_ZOOM,""+e.offsetWidth/i.offsetWidth))}stopReel(t){const{speed:e}=this,s=(performance.now()-this.lastUpdate)*e;this.currentCombination.push(this.reels[t].stop(e,s)),m.stop(),E.stop()}checkPrize(){const{currentCombination:t,reelCount:e,symbols:s}=this,i={};let o=0,n="",a="",l=0;for(let c=0;c<e;++c){const e=t[c],h=i[e]=n===e?i[e]+1:1;if(n=e,h>o){o=h;const t=s.indexOf(e);t>s.indexOf(a)&&(a=e,l=t+1)}}return o>2?o*(l/s.length)/e:null}handleResize(){requestAnimationFrame((()=>this.resize()))}handleKeyDown(t){window.clearTimeout(this.keydownTimeoutID);const{key:e}=t;if(this.isPaused||document.activeElement!==document||![" ","Enter"].includes(e))return;const s=Date.now()-this.keydownLastCalled;s>=1e3?this.handleClick():this.keydownTimeoutID=window.setTimeout(this.handleClick.bind(this),1e3-s)}handleKeyUp(t){[" ","Enter"].includes(t.key)&&(window.clearTimeout(this.keydownTimeoutID),this.keydownLastCalled=0)}handleClick(t=null){if(window.clearTimeout(this.keydownTimeoutID),this.keydownLastCalled=Date.now(),t){const{target:e}=t,s=e.tagName,i=e.parentElement.tagName;if(/^A|BUTTON$/.test(s)||/^A|BUTTON$/.test(i))return void document.activeElement.blur();if(3===t.which)return}const{currentReel:e}=this;null===e?this.start():(++this.currentReel,this.stopReel(e),e===this.reels.length-1&&this.stop())}pause(){N(null),this.isPaused=!0}resume(){N(this.handleClick),this.isPaused=!1,null!==this.currentReel&&requestAnimationFrame((()=>this.tick()))}}function f(t=""){return t.toLowerCase().split("-").map((t=>`${t[0].toUpperCase()}${t.substring(1)}`)).join(" ")}class D{static C_IS_DISABLED="is-disabled";root;icon;key;value;onButtonClick;constructor(t,e,s,i){const o=this.root=document.querySelector(t);this.icon=o.children[0],this.key=e,this.onButtonClick=i,s?this.enable():this.disable(),o.onclick=this.handleButtonClicked.bind(this)}enable(){const t=f(this.key);this.root.classList.remove(D.C_IS_DISABLED),this.root.setAttribute("title",`Turn ${t} Off`),this.root.setAttribute("aria-label",`Turn ${t} Off`),this.icon.setAttribute("aria-label",`${t} Is On`),this.value=!0,this.onButtonClick&&this.onButtonClick(this.key,!0)}disable(){const t=f(this.key);this.root.classList.add(D.C_IS_DISABLED),this.root.setAttribute("title",`Turn ${t} On`),this.root.setAttribute("aria-label",`Turn ${t} On`),this.icon.setAttribute("aria-label",`${t} Is Off`),this.value=!1,this.onButtonClick&&this.onButtonClick(this.key,!1)}toggle(){this.value?this.disable():this.enable()}handleButtonClicked(t){t.stopPropagation(),document.activeElement.blur(),this.toggle()}}class P{static C_IS_OPEN="is-open";root;label;isOpen;onButtonClick;constructor(t,e,s,i){const o=this.root=document.querySelector(t);this.label=e,this.onButtonClick=i,s?this.open():this.close(),o.onclick=this.handleButtonClicked.bind(this)}open(){const{label:t}=this;this.root.classList.add(P.C_IS_OPEN),this.root.setAttribute("title",`Close ${t}`),this.root.setAttribute("aria-label",`Close ${t}`),this.isOpen=!0,this.onButtonClick&&this.onButtonClick(!0)}close(){const{label:t}=this;this.root.classList.remove(P.C_IS_OPEN),this.root.setAttribute("title",`Open ${t}`),this.root.setAttribute("aria-label",`Open ${t}`),this.isOpen=!1,this.onButtonClick&&this.onButtonClick(!1)}toggle(){this.isOpen?this.close():this.open()}handleButtonClicked(t){t.stopPropagation(),document.activeElement.blur(),this.toggle()}}class R{static OPEN_MODAL=null;static S_CLOSE_BUTTON=".modal__button";static C_IS_OPEN="is-open";root;closeButton;modalButton;key;isOpen;isFixed;onModalToggled;constructor(t,e,s,i,o,n){this.root=document.querySelector(t),this.closeButton=this.root.querySelector(R.S_CLOSE_BUTTON),this.modalButton=new P(e,f(s),i,this.handleButtonClicked.bind(this)),this.key=s,this.onModalToggled=n,i?this.open("init",o):this.close("init"),this.handleKeyDown=this.handleKeyDown.bind(this),this.handleClickOutside=this.handleClickOutside.bind(this),this.closeButton.onclick=t=>{t.stopPropagation(),document.activeElement.blur(),this.close("close")}}addEventListeners(){document.addEventListener("keydown",this.handleKeyDown),document.addEventListener("click",this.handleClickOutside)}removeEventListeners(){document.removeEventListener("keydown",this.handleKeyDown),document.removeEventListener("click",this.handleClickOutside)}handleKeyDown({key:t}){this.isFixed||"Esc"!==t&&"Escape"!==t||this.close("esc")}handleButtonClicked(t){this.isFixed||void 0===this.isOpen||this.isOpen===t||this.toggle("toggle")}handleClickOutside({target:t}){this.isFixed||t===this.root||this.root.contains(t)||this.close("outside")}open(t,e){R.OPEN_MODAL&&R.OPEN_MODAL.close(),R.OPEN_MODAL=this,e&&this.setFixed(),this.root.classList.add(R.C_IS_OPEN),this.isOpen=!0,this.isFixed=e,this.onModalToggled&&this.onModalToggled(!0,`${this.key}-${t}`),this.modalButton.open(),this.addEventListeners()}close(t){R.OPEN_MODAL=null,this.removeEventListeners(),this.root.classList.remove(R.C_IS_OPEN),this.isFixed&&this.setDismissible(),this.isOpen=!1,this.isFixed=!1,this.onModalToggled&&this.onModalToggled(!1,`${this.key}-${t}`),this.modalButton.close()}toggle(t){this.isOpen?this.close(t):this.open(t)}setFixed(){this.closeButton.setAttribute("hidden",!0)}setDismissible(){this.closeButton.removeAttribute("hidden")}}class v{static C_BASE="pt__base";static C_ACTIVE="pt__base--activeC";static C_COLUMN="pt__c";static S_ROOT=".pt__base";static S_HEADER=".pt__header";static S_INITIALLY_ACTIVE_COLUMN=".pt__header .pt__c2";root=document.querySelector(v.S_ROOT);payMatrix={};activeColumn=null;constructor(t){const e=t.length;this.root.innerHTML='\n            <li class="pt__header">\n                <div class="pt__rowContent">\n                    <span class="pt__c1"></span>\n                    <button class="pt__c2 pt__tab"><span class="pt__tabText">× 3</span></button>\n                    <button class="pt__c3 pt__tab"><span class="pt__tabText">× 4</span></button>\n                    <button class="pt__c4 pt__tab"><span class="pt__tabText">× 5</span></button>\n                </div>\n            </li>\n        '+t.map(((t,s)=>{const i=(s+1)/e*100,o=.6*i,n=.8*i,a=i;return this.payMatrix[t]=[o,n,a],`\n                <li class="pt__row">\n                    <div class="pt__rowContent">\n                        <span class="pt__c1">${t}</span>\n                        <span class="pt__c2">${o.toFixed(2)} %</span>\n                        <span class="pt__c3">${n.toFixed(2)} %</span>\n                        <span class="pt__c4">${a.toFixed(2)} %</span>\n                    </div>\n                </li>\n            `})).join(""),this.activeColumn=this.root.querySelector(v.S_INITIALLY_ACTIVE_COLUMN),this.root.querySelector(v.S_HEADER).addEventListener("click",this.handleColumnClicked.bind(this))}handleColumnClicked({target:t}){const e=parseInt(t.className.replace(v.C_COLUMN,""),10)||0;e<=1||t===this.activeColumn||(this.activeColumn=t,this.root.className=`${v.C_BASE} ${v.C_ACTIVE}${e}`,document.activeElement.blur())}}const B={sound:m,vibration:E},U=(t,e)=>{const s=B[t];s&&s[e?"enable":"disable"](),localStorage.setItem(t,e)};class x{static C_FOCUS_ACTIVE="focus-active";static S_COINS="#coins";static S_JACKPOT="#jackpot";static S_SPINS="#spins";static S_MAIN="#main";static S_TOGGLE_SOUND="#toggleSound";static S_TOGGLE_VIBRATION="#toggleVibration";static S_VIBRATION_INSTRUCTIONS="#vibrationInstructions";static S_INSTRUCTIONS_MODAL="#instructionsModal";static S_INSTRUCTIONS_MODAL_BUTTON="#toggleInstructions";static S_PAY_TABLE_MODAL="#payTableModal";static S_PAY_TABLE_MODAL_BUTTON="#togglePayTable";static S_PLAY="#playButton";static ONE_DAY=864e5;coinsElement=document.querySelector(x.S_COINS);jackpotElement=document.querySelector(x.S_JACKPOT);spinsElement=document.querySelector(x.S_SPINS);mainElement=document.querySelector(x.S_MAIN);slotMachine;payTable;instructionsModal;coins=parseInt(localStorage.coins,10)||100;jackpot=parseInt(localStorage.jackpot,10)||1e3;spins=parseInt(localStorage.spins,10)||0;lastSpin=localStorage.lastSpin||0;isSoundDisabled="false"===localStorage.sound;isVibrationDisabled="false"===localStorage.vibration;isFirstTime="false"!==localStorage.firstTime;constructor(){const t=Date.now();t-this.lastSpin>=x.ONE_DAY&&(localStorage.jackpot=this.jackpot=0|Math.max(500,this.jackpot-500+1e3*Math.random()),localStorage.lastSpin=t),this.handleModalToggle=this.handleModalToggle.bind(this),this.handleUseCoin=this.handleUseCoin.bind(this),this.handleGetPrice=this.handleGetPrice.bind(this);let e=!1;document.addEventListener("keydown",(t=>{"Tab"!==t.key||e?"Escape"===t.key&&e&&(e=!1,document.body.classList.remove(x.C_FOCUS_ACTIVE)):(e=!0,document.body.classList.add(x.C_FOCUS_ACTIVE))})),document.addEventListener("mousedown",(()=>{e=!1,document.body.classList.remove(x.C_FOCUS_ACTIVE)})),this.initUI()}handleUseCoin(){localStorage.coins=this.coins=Math.max(this.coins-1,0)||100,localStorage.jackpot=++this.jackpot,localStorage.spins=++this.spins,localStorage.lastSpin=this.lastSpin=Date.now(),this.refreshGameInfo()}handleGetPrice(t){const e=Math.min(Math.max(Math.ceil(t*this.jackpot),10),this.jackpot);localStorage.jackpot=this.jackpot=Math.max(this.jackpot-e,0)||1e3,localStorage.coins=this.coins+=e,this.refreshGameInfo()}refreshGameInfo(){const t=Math.max(this.coins,this.jackpot,this.spins),e=Math.max(2*Math.ceil(t.toString().length/2),5);this.coinsElement.innerText=`${this.coins}`.padStart(e,"0"),this.jackpotElement.innerText=`${this.jackpot}`.padStart(e,"0"),this.spinsElement.innerText=`${this.spins}`.padStart(e,"0")}initUI(){const{isFirstTime:t}=this;this.refreshGameInfo(),n||(document.querySelector(x.S_TOGGLE_VIBRATION).parentElement.setAttribute("hidden",!0),document.querySelector(x.S_VIBRATION_INSTRUCTIONS).setAttribute("hidden",!0)),this.initToggleButtons();const e=document.querySelector(x.S_PLAY);t?e.onclick=()=>{this.isFirstTime=localStorage.firstTime=!1,e.setAttribute("hidden",!0),this.instructionsModal.close(),document.activeElement.blur(),this.slotMachine.start()}:e.setAttribute("hidden",!0),this.instructionsModal=new R(x.S_INSTRUCTIONS_MODAL,x.S_INSTRUCTIONS_MODAL_BUTTON,"instructions",t,t,this.handleModalToggle),this.slotMachine=new M(this.mainElement,this.handleUseCoin,this.handleGetPrice,5,s,t),this.payTable=new v(s),new R(x.S_PAY_TABLE_MODAL,x.S_PAY_TABLE_MODAL_BUTTON,"pay-table",!1,!1,this.handleModalToggle)}initToggleButtons(){new D(x.S_TOGGLE_SOUND,"sound",!this.isSoundDisabled,U),n&&new D(x.S_TOGGLE_VIBRATION,"vibration",!this.isVibrationDisabled,U)}handleModalToggle(t,e){this.slotMachine&&!e.includes("-init")&&(t?this.slotMachine.pause():this.slotMachine.resume())}}new x}()}();
//# sourceMappingURL=main.297861a091df6e36c056.js.map